<div class="user-type" id="thirdpayopen">
<form class="personal-account" id="thirdpayopenForm" method="post">


	<!-- 此层为基本信息---------------------------->
	<#include 'register_basic_person.html'>
	<!--  end -------------------------------------------------------------------------------------------------------------->
	
	<!--  start 此层分为三方支付----------------------------------------------------------------------------------------------------------->
	
	<#include 'register_tp_bankinfo.html'>

<!--  end -------------------------------------------------------------------------------------------------------------->
	
	</form>	
	
</div>

<script>
String.prototype.startWith=function(s){
	  if(s==null||s==""||this.length==0||s.length>this.length)
	   return false;
	  if(this.substr(0,s.length)==s)
	     return true;
	  else
	     return false;
	  return true;
	 }
//邮政储蓄
var aarray = new Array("621098","622150","622151","622181","622188","955100","621095","620062","621285","621798","621799","621797","622199","621096","62215049","62215050","62215051","62218850","62218851","62218849","621622","623219","621674","623218","623698","623699","623686","622180","622182","625586");
//工商
var barray = new Array("370246","370248","370249","427010","427018","427019","427020","427029","427030","427039","370247","438125","438126","451804","451810","451811","45806","458071","489734","489735","489736","427062","427064","530970","53098","530990","558360","620200","620302","620402","620403","620404","524047","620406","620407","525498","620409","620410","620411","620412","620502","620503","620405","620408","620512","620602","620604","620607","620611","620612","620704","620706","620707","620708","620709","620710","620609","620712","620713","620714","620802","620711","620904","620905","621001","620902","621103","621105","621106","621107","621102","621203","621204","621205","621206","621207","621208","621209","621210","621302","621303","621202","621305","621306","621307","621309","621311","621313","621211","621315","621304","621402","621404","621405","621406","621407","621408","621409","621410","621502","621317","621511","621602","621603","621604","621605","621608","621609","621610","621611","621612","621613","621614","621615","621616","621617","621607","621606","621804","621807","621813","621814","621817","621901","621904","621905","621906","621907","621908","621909","621910","621911","621912","621913","621915","622002","621903","622004","622005","622006","622007","622008","622010","622011","622012","621914","622015","622016","622003","622018","622019","622020","622102","622103","622104","622105","622013","622111","622114","622017","622210","622211","622212","622213","622214","622110","622220","622223","622225","622229","622230","622231","622232","622233","622234","622235","622237","622215","622239","622240","622245","622224","622303","622304","622305","622306","622307","622308","622309","622238","622314","622315","622317","622302","622402","622403","622404","622313","622504","622505","622509","622513","622517","622502","622604","622605","622606","622510","622703","622715","622806","622902","622903","622706","623002","623006","623008","623011","623012","622904","623015","623100","623202","623301","623400","623500","623602","623803","623901","623014","624100","624200","624301","624402","62451804","62451810","62451811","6245806","62458071","6253098","623700","628288","624000","9558","628286","622206","526836","513685","543098","458441","622246","900000","544210","548943","370267","621558","621559","621722","621723","621226","402791","427028","427038","548259","356879","356880","356881","356882","528856","620516","621721","900010","625330","625331","625332","622236","524374","550213","621288","625708","625709","622597","622599","360883","360884","625865","625866","625899","374738","374739","510529","524091","625650","622910","622911","622912","622913","625858","625859","625860","625160","625161","625162","620086","621670","621218","621475","621476","623229","623260","620058","621225","621227","621281","621618","622200","622202","622203","622208","623062","623271","623272","625929","621376","620054","620142","621423","625927","621428","625939","621434","625987","621761","621749","620184","625930","623321","621300","621378","625114","622159","621720","625021","625022","625932","621379","620114","620146","622889","625900","622949","625915","625916","620030","620050","622944","625115","620101","623335","625941","625801","622171","621240","621724","625931","621762","625918","625113","621371","620143","620149","62137310","62137320","62592310","62592320","62592340","62013101","62013102","621730","625928","621414","625914","621375","620187","621734","621433","625986","621370","625925","622926","622927","622928","622929","622930","622931","621733","621732","620124","620183","620561","625116","622227","625921","621764","625926","621372","623034","625110","621464","625942","62594250","62594260","62594270","622158","625917","621765","620094","620186","621719","621719","625922","621369","621763","625934","620046","621750","625933","621377","620148","620185","625920","621367","625924","621374","621731","621781");
//农业
var carray = new Array("103","552599","6349102","6353591","623206","621671","620059","403361","404117","404118","404119","404120","404121","463758","49102","514027","519412","519413","520082","520083","53591","558730","621282","621336","621619","622821","622822","622823","622824","622825","622826","622827","622828","622836","622837","622840","622841","622843","622844","622845","622846","622847","622848","622849","623018","625996","625997","625998","628268","95595","95596","95597","95598","95599","622839","625826","625827","548478","544243","622820","622830","622838","625336","628269","625170","625653","628346","625171","620501");
//中国
var darray = new Array("621660","621661","621663","621665","621667","621668","621666","625908","625910","625909","356833","356835","409665","409666","409668","409669","409670","409671","409672","456351","512315","512316","512411","512412","514957","409667","518378","518379","518474","518475","518476","438088","524865","525745","525746","547766","552742","553131","558868","514958","622752","622753","622755","524864","622757","622758","622759","622760","622761","622762","622763","601382","622756","628388","621256","621212","620514","622754","622764","518377","622765","622788","621283","620061","621725","620040","558869","621330","621331","621332","621333","621297","377677","621568","621569","625905","625906","625907","628313","625333","628312","623208","621620","621756","621757","621758","621759","621785","621786","621787","621788","621789","621790","621672","625337","625338","625568","621669","621662","623571","623572","623573","623575","623263","623184","623569","623586","625834","620025","620026","621293","621294","621342","621343","621364","621394","621648","621248","621215","621249","622771","622772","622770","620531","620210","620211","622479","622480","622273","622274","622380","620019","620035","621231","622789","621638","621334","625140","621395","620513");
//建设
var earray = new Array("5453242","5491031","5544033","622725","622728","621284","421349","434061","434062","436728","436742","453242","491031","524094","526410","53242","53243","544033","552245","589970","620060","621080","621081","621466","621467","621488","621499","621598","621621","621700","622280","622700","622707","622966","622988","625955","625956","553242","621082","623251","621673","623211","623668","623094","6233670","6233671","6233672","6233673","6233674","6233675","436742193","622280193","356896","356899","356895","436718","436738","436745","436748","489592","531693","532450","532458","544887","552801","557080","558895","559051","622166","622168","622708","625964","625965","625966","628266","628366","625362","625363","628316","628317");
//交通
var farray = new Array("620021","620521","00405512","0049104","0053783","00601428","405512","434910","458123","458124","49104","520169","522964","53783","552853","601428","622250","622251","521899","622254","622255","622256","622257","622258","622259","622253","622261","622284","622656","628216","622252","66405512","6649104","622260","66601428","955590","955591","955592","955593","6653783","628218","622262","623261","622285","621069","620013","625028","625029","621436","621002","621335");
//中信
var garray = new Array("433670","433680","442729","442730","620082","622690","622691","622692","622696","622698","622998","622999","433671","968807","968808","968809","621771","621767","621768","621770","621772","621773","620527","621769");
//光大
var harray = new Array("303","356837","356838","486497","622660","622662","622663","622664","622665","622666","622667","622669","622670","622671","622672","622668","622661","622674","90030","622673","620518","621489","621492","620535","623156","621490","621491","620085","623155","623157","623158","623159","623253");
//华夏
var iarray = new Array("999999","621222","623020","623021","623022","623023","622630","622631","622632","622633","620552");
//民生
var jarray = new Array("622615","622616","622618","622622","622617","622619","415599","421393","421865","427570","427571","472067","472068","622620","621691","623255","900003","623258","623683","545392","545393","545431","545447","356859","356857","407405","421869","421870","421871","512466","356856","528948","552288","622600","622601","622602","517636","622621","628258","556610","622603","464580","464581","523952","545217","553161","356858","622623","625911","377152","377153","377158","377155","625912","625913","625188");
//招商
var karray = new Array("356885","356886","356887","356888","356890","439188","439227","479229","521302","356889","552534","622575","622576","622581","690755","95555","628290","622578","402658","410062","468203","479228","512425","524011","545619","545620","545621","545623","545947","545948","552587","620520","621286","621483","621485","621486","622577","622579","622580","622582","622588","622598","622609","690755","623126","623136","623262","370285","370286","370287","370289","439225","518710","518718","628362","439226","628262","625802","625803","621299");
//广发
var larray = new Array("406365","406366","428911","436768","436769","487013","491032","491034","491035","491036","491037","491038","518364","520152","520382","548844","552794","622555","622556","622557","622558","622559","622560","622568","528931","9111","558894","625072","625071","628260","628259","621462","625805","625806","625807","625808","625809","625810","685800","620037","6858000","6858001","6858009","623506","623259");
//平安
var marray = new Array("412963","415752","415753","622538","998800","412962","620010","622535","622536","622539","622983","621626","623058","602907","622986","622989","622298");
//兴业
var narray = new Array("90592","966666","622909","622908","438588","438589","461982","486493","486494","486861","523036","451289","527414","528057","622901","622902","622922","628212","451290","524070","625084","625085","625086","625087","548738","549633","552398","625082","625083","625960","625961","625962","625963","625353","625356","622571","622572","622573","622591","622592","622593");
//浦发
var oarray = new Array("356851","356852","404738","404739","456418","498451","515672","356850","517650","525998","622177","622277","622516","622517","622518","622520","622521","622522","622523","628222","84301","84336","84373","628221","84385","84390","87000","87010","87030","87040","84380","984301","984303","84361","87050","622176","622276","622228","621351","621390","621792","625957","625958","621791","84342","620530","625993","622519","621793","621795","621796","622500","623250","621352");
//汉口
var parray = new Array("990027","622325","623029","623105","62326510","622625","622626","625946","628200","622566","622567");
//齐商
var qarray = new Array("940057","622311","623119");
//枣庄银行
var rarray = new Array("623087");
//上海
var sarray = new Array("623183","623185","621005","622172","622985","622987","622267","622278","622279","622468","622892","940021","621050","620522","621243","356827","356828","356830","402673","402674","438600","486466","519498","520131","524031","548838","622148","622149","622268","356829","622300","628230","622269","625099","625953","625350","625351","625352","519961","625839","625180");
//泰安商业
var tarray = new Array("622972","623196");
var banktype=1000;

var riskflag = $("#riskflag").val();

var kifpwebregister_tp = kifpwebregister_tp || {};

kifpwebregister_tp.registerbingding = {
	
	init:function(){
		var self = this;
		$thirdpayopenForm = $("#thirdpayopenForm").kdValidform();
		//初始化
		$("#channelcode").val($(".tieonBanks a.selected").attr("_bankid"));
		$("#tbankcode").val($(".tieonBanks a.selected").attr("_bankcode"));
		$("#tchannelcode").val($(".tieonBanks a.selected").attr("_bankid"));
		
		var _type = "${t!''}";
		if(_type == 'psl'){
			$('#bancodeinput').attr("datatype","n9-19");
		}else if(_type==""){
			$('#bancodeinput').attr("datatype","n9-19");
		}else{
			$('#bancodeinput').attr("datatype","/^[0-9]*{0,32}$/");
		}

		/* $("a[_bankId]").on("click",function(){
		    $("#channelcode").val();
			$("#tbankcode").val();
			$("#tchannelcode").val();
			var current = $(this);
			$(".tieonBanks a").removeClass("selected");
			current.addClass("selected");
			var channelcode = current.attr("_bankid");
			var tbankcode = current.attr("_bankcode")
			$("#channelcode").val(channelcode);
			$("#tbankcode").val(tbankcode);
			$("#tchannelcode").val(channelcode);
		}); */
		
		$("#openthirdpayAccountBtn").on("click",function(){
			$("#openthirdpayAccountBtn").attr("disabled", true);
			self.openthirdpayaccount();
		
		});
		
	}
	,openthirdpayaccount:function(){
		$("#J_prove").val($("#J_province").find("option:selected").text());
		$("#tradepassword").val("");
		var $thirdpayopenForm;
		$thirdpayopenForm = $("#thirdpayopenForm").kdValidform();
		selectBankAuto();
		var _tradepwd =$("#tradepwd").val();
		var _tradepwd_ = $.des.getDes(_tradepwd);	
		$("#tradepassword").val(_tradepwd_);
		var options = {
				type:"post",
				dataType:"json",
				async:true,
				url :"${kasp_url}mall/newRegister!openThirdpayAccount.do?ajax=yes",
				success : function(data) {
					if(data.result == 1){
						if(riskflag == '1'){//根据风险测评参数显示不同页面
							zhejiang_alert("消息","开户成功",function(){
								window.location.href = "register.html?type=fxcp";
							});
						}else{
							riskEstimate();
						}
					}else if(data.result == 0){
						zhejiang_alert("消息",data.message, function(){
							$.kd.closeLoading();
							$("#openthirdpayAccountBtn").attr("disabled",false);
							$("#tradepwd").attr("name","tradepwd_");
						});
					
					}
				},
				error:function(data) {
					zhejiang_alert("消息","系统异常，请联系管理员！",function(){
						$.kd.closeLoading();
						$("#openthirdpayAccountBtn").attr("disabled",false);
						$("#tradepwd").attr("name","tradepwd_");
					});
				}
		
		};
		if($thirdpayopenForm.check()){
			$("#openthirdpayAccountBtn").attr("disabled",true);
			$.kd.showLoading($("#openthirdpayAccountBtn"));
			$("#tradepwd").removeAttr("name");
			$("#thirdpayopenForm").ajaxSubmit(options);
		}
	
	}
	,bankselected:function(){
		var current = $(this);
		$(".tieonBanks a").removeClass("selected");
		current.addClass("selected");
	}
}

/* $(function(){
	kifpwebregister_tp.registerbingding.init();
}); */

//进入风险测评方法，不执行方法
function riskEstimate(){
	$.ajax({
		  type:"post" ,
		  async:false,
		  dataType : "text",
		  url: "${kasp_url}mall/newRiskEstimate!doEstimate.do?ajax=yes",
		  success: function(redata){
			var redta = eval("("+redata+")");
			if(redta.result == 1){
				$.kd.kdAlert("恭喜您完成注册及绑定", function() {
				window.location.href='account_asset.html';
			},'温馨提示');	
			}else{
				$.kd.kdAlert("交易权限申请失败！", function() {
				window.location.href='account_asset.html';
			});
			}
		  },
		  error:function(redata){
			$.kd.kdAlert("交易权限申请失败！", function() {
				window.location.href='account_asset.html';
			});
		  }
	  });  
}


$("#J_province").change(function(){
		$("#J_city").find("option").remove();
		$("#openbankaddr").find("option").remove();
		var cityid = $("#J_province").attr("value");
		$.post("${kasp_url}mall/newRegister!getPayCity.do?ajax=yes", 
				{ "cityid": cityid },
				   function(data){
					var i = 0;
					var arr = new Array();
					$("#J_city").append( "<option value=\"-1\">--选择城市--</option>" );
					for(i;i < data.kdjson.len;i++){
						arr[i] = data.kdjson.items[i].areanames;
						$("#J_city").append( "<option value=\""+ arr[i] +"\">" + arr[i] + "</option>" );
					}
				   }, "json");
	});

</script>

<script>


$(function(){
	kifpwebregister_tp.registerbingding.init();
	$("#bancodeinput").bind("blur", function() {
	var bancode = $("#bancodeinput").val().replace(/\s+/g,"");
	if(bancode!=''){
	$("span[invitornamespan]").removeClass("kdValidform_warn");
	$("span[invitornamespan]").html("");
	//$("span[invitornamespan]").remove();
	//alert(bancode);
	var flag = luhmCheck(bancode);
	//alert(luhmCheck(bancode));
	if(flag){
		selectBankAuto();
		$("span[invitornamespan]").attr("class","kdValidform_right");
		$("#bancodeinput").removeClass();
		$("#bancodeinput").removeAttr("datatype");
		}else{
		$("span[invitornamespan]").addClass("kdValidform_wrong");
		$("span[invitornamespan]").html("银行卡号输入有误！");
		}	
		}
	});
});



function selectBankAuto(){
	var bancode = $("#bancodeinput").val().replace(/\s+/g,"");
	var banktest = /^\d{9,19}$/;
	var status ="0";
	if (banktest.test(bancode)) {
	for(var i=0;i<aarray.length;i++){
		 if(bancode.startWith(aarray[i])){
			 $("#channelcode").val("100");
				$("#tbankcode").val("邮政储蓄");
				$("#tchannelcode").val("100");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"100").addClass("selected");
				status ="1";
			 break;
		 }
		}
	for(var i=0;i<barray.length;i++){
		 if(bancode.startWith(barray[i])){
			 $("#channelcode").val("102");
				$("#tbankcode").val("工商银行");
				$("#tchannelcode").val("102");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"102").addClass("selected");
				status ="1";
			 break;
		 }
		}
	for(var i=0;i<carray.length;i++){
		 if(bancode.startWith(carray[i])){
			 $("#channelcode").val("103");
				$("#tbankcode").val("农业银行");
				$("#tchannelcode").val("103");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"103").addClass("selected");
				status ="1";
			 break;
		 }
		}
	for(var i=0;i<darray.length;i++){
		 if(bancode.startWith(darray[i])){
			 $("#channelcode").val("104");
				$("#tbankcode").val("中国银行");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"104").addClass("selected");
				$("#tchannelcode").val("104");status ="1";
			 break;
		 }
		}
	for(var i=0;i<earray.length;i++){
		 if(bancode.startWith(earray[i])){
			 $("#channelcode").val("105");
				$("#tbankcode").val("建设银行");
				$("#tchannelcode").val("105");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"105").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<farray.length;i++){
		 if(bancode.startWith(farray[i])){
			 $("#channelcode").val("301");
				$("#tbankcode").val("交通银行");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"301").addClass("selected");
				$("#tchannelcode").val("301");status ="1";
			 break;
		 }
		}
	
	for(var i=0;i<garray.length;i++){
		 if(bancode.startWith(garray[i])){
			 $("#channelcode").val("302");
				$("#tbankcode").val("中信银行");
				$("#tchannelcode").val("302");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"302").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<harray.length;i++){
		 if(bancode.startWith(harray[i])){
			 $("#channelcode").val("303");
				$("#tbankcode").val("光大银行");
				$("#tchannelcode").val("303");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"303").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<iarray.length;i++){
		 if(bancode.startWith(iarray[i])){
			 $("#channelcode").val("304");
				$("#tbankcode").val("华夏银行");
				$("#tchannelcode").val("304");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"304").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<jarray.length;i++){
		 if(bancode.startWith(jarray[i])){
			 $("#channelcode").val("305");
				$("#tbankcode").val("民生银行");
				$("#tchannelcode").val("305");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"305").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<karray.length;i++){
		 if(bancode.startWith(karray[i])){
			 $("#channelcode").val("308");
				$("#tbankcode").val("招商银行");
				$("#tchannelcode").val("308");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"308").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<larray.length;i++){
		 if(bancode.startWith(larray[i])){
			 $("#channelcode").val("306");
				$("#tbankcode").val("广发银行");
				$("#tchannelcode").val("306");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"306").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<marray.length;i++){
		 if(bancode.startWith(marray[i])){
			 $("#channelcode").val("307");
				$("#tbankcode").val("平安银行");
				$("#tchannelcode").val("307");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"307").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<narray.length;i++){
		 if(bancode.startWith(narray[i])){
			 $("#channelcode").val("309");
				$("#tbankcode").val("兴业银行");
				$("#tchannelcode").val("309");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"309").addClass("selected");status ="1";
			 break;
		 }
		}
	
	for(var i=0;i<oarray.length;i++){
		 if(bancode.startWith(oarray[i])){
			 $("#channelcode").val("310");
				$("#tbankcode").val("浦发银行");
				$("#tchannelcode").val("310");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"310").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<parray.length;i++){
		 if(bancode.startWith(parray[i])){
			 $("#channelcode").val("3135210");
				$("#tbankcode").val("汉口银行");
				$("#tchannelcode").val("3135210");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"3135210").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<qarray.length;i++){
		 if(bancode.startWith(qarray[i])){
			 $("#channelcode").val("3134530");
				$("#tbankcode").val("齐商银行");
				$("#tchannelcode").val("3134530");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"3134530").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<rarray.length;i++){
		 if(bancode.startWith(rarray[i])){
			 $("#channelcode").val("3134540");
				$("#tbankcode").val("枣庄银行");
				$("#tchannelcode").val("3134540");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"3134540").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<sarray.length;i++){
		 if(bancode.startWith(sarray[i])){
			 $("#channelcode").val("4012900");
				$("#tbankcode").val("上海银行");
				$("#tchannelcode").val("4012900");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"4012900").addClass("selected");status ="1";
			 break;
		 }
		}
	for(var i=0;i<tarray.length;i++){
		 if(bancode.startWith(tarray[i])){
			 $("#channelcode").val("3134630");
				$("#tbankcode").val("泰安商业银行");
				$("#tchannelcode").val("3134630");
				$(".tieonBanks a").removeClass("selected");
			$("#bank"+"3134630").addClass("selected");status ="1";
			 break;
		 }
		}
	if(status=="0"){
		$("#channelcode").val("");
		$("#tbankcode").val("");
		$("#tchannelcode").val("");
		$(".tieonBanks a").removeClass("selected");
		if (banktest.test(bancode)&&bancode!="") {
		$(".tieonBanks a").removeClass("selected");
		$("#bankMsg").attr("class","kdValidform_checktip kdValidform_wrong");
		$("#bankMsg").html("暂不支持该银行！");
		}else{
		$("#bankMsg").attr("class","");
		$("#bankMsg").html("");
		}
	}else{
$("#bankMsg").attr("class","");
		$("#bankMsg").html("");
	}
	}
}
$("#J_province").change(function(){
		$("#J_city").find("option").remove();
		$("#openbankaddr").find("option").remove();
		var cityid = $("#J_province").attr("value");
		$.post("${kasp_url}mall/newRegister!getPayCity.do?ajax=yes", 
				{ "cityid": cityid },
				   function(data){
					var i = 0;
					var arr = new Array();
					$("#J_city").append( "<option value=\"-1\">--选择城市--</option>" );
					for(i;i < data.kdjson.len;i++){
						arr[i] = data.kdjson.items[i].areanames;
						$("#J_city").append( "<option value=\""+ arr[i] +"\">" + arr[i] + "</option>" );
					}
				   }, "json");
});

</script>
<script>
	window.onload=function()
	{
		var oT=document.getElementById('bancodeinput');
		oT.onkeydown=function(ev)
		{   
			var oW=oT.value;
			var oEvent=ev||event;
			if(oEvent.keyCode==8)
			{
				if(oW)
				{
					for(var i=0;i<oW.length;i++)
					{
						var newStr=oW.replace(/\s$/g,'');
					}
					oT.value=newStr
				}
			}else{
				for(var i=0;i<oW.length;i++)
				{
					var arr=oW.split('');

					if((i+1)%5==0)
					{
						arr.splice(i,0,' ');
					}
				}
				oT.value=arr.join('');
			}
		}
	}
	
	function luhmCheck(bankno){
    var lastNum=bankno.substr(bankno.length-1,1);//取出最后一位（与luhm进行比较）
 
    var first15Num=bankno.substr(0,bankno.length-1);//前15或18位
    var newArr=new Array();
    for(var i=first15Num.length-1;i>-1;i--){    //前15或18位倒序存进数组
        newArr.push(first15Num.substr(i,1));
    }
    var arrJiShu=new Array();  //奇数位*2的积 <9
    var arrJiShu2=new Array(); //奇数位*2的积 >9
     
    var arrOuShu=new Array();  //偶数位数组
    for(var j=0;j<newArr.length;j++){
        if((j+1)%2==1){//奇数位
            if(parseInt(newArr[j])*2<9)
            arrJiShu.push(parseInt(newArr[j])*2);
            else
            arrJiShu2.push(parseInt(newArr[j])*2);
        }
        else //偶数位
        arrOuShu.push(newArr[j]);
    }
     
    var jishu_child1=new Array();//奇数位*2 >9 的分割之后的数组个位数
    var jishu_child2=new Array();//奇数位*2 >9 的分割之后的数组十位数
    for(var h=0;h<arrJiShu2.length;h++){
        jishu_child1.push(parseInt(arrJiShu2[h])%10);
        jishu_child2.push(parseInt(arrJiShu2[h])/10);
    }        
     
    var sumJiShu=0; //奇数位*2 < 9 的数组之和
    var sumOuShu=0; //偶数位数组之和
    var sumJiShuChild1=0; //奇数位*2 >9 的分割之后的数组个位数之和
    var sumJiShuChild2=0; //奇数位*2 >9 的分割之后的数组十位数之和
    var sumTotal=0;
    for(var m=0;m<arrJiShu.length;m++){
        sumJiShu=sumJiShu+parseInt(arrJiShu[m]);
    }
     
    for(var n=0;n<arrOuShu.length;n++){
        sumOuShu=sumOuShu+parseInt(arrOuShu[n]);
    }
     
    for(var p=0;p<jishu_child1.length;p++){
        sumJiShuChild1=sumJiShuChild1+parseInt(jishu_child1[p]);
        sumJiShuChild2=sumJiShuChild2+parseInt(jishu_child2[p]);
    }      
    //计算总和
    sumTotal=parseInt(sumJiShu)+parseInt(sumOuShu)+parseInt(sumJiShuChild1)+parseInt(sumJiShuChild2);
     
    //计算Luhm值
    var k= parseInt(sumTotal)%10==0?10:parseInt(sumTotal)%10;        
    var luhm= 10-k;
     
    if(lastNum==luhm){
    $("#banknoInfo").html("Luhm验证通过");
    return true;
    }
    else{
    $("#banknoInfo").html("银行卡号必须符合Luhm校验");
    return false;
    }        
}
	</script>